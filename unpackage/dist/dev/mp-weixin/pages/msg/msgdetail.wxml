<view class="page"><free-navbar vue-id="4ac1f80b-1" isshowback="{{true}}" isshowdefaultcolor="{{true}}" title="{{chat.TO.username||chat.TO.name}}" noreadnum="{{allnoreadnum>0?allnoreadnum:''}}" showsearch="{{false}}" bind:__l="__l" vue-slots="{{['options']}}"><view slot="options"><text data-event-opts="{{[['tap',[['toset',['$event']]]]]}}" class="iconfont mr-2" bindtap="__e"></text></view></free-navbar><scroll-view class="position-fixed page left-0 right-0  px-3  vue-ref" style="{{('top:'+navheight+'px;'+'bottom:'+chatbodybottom+'px')}}" show-scrollbar="{{false}}" scroll-y="{{true}}" scroll-top="{{9999}}" data-ref="chatbody"><view class="flex align-center justify-center mb-2"><text class="text-light-muted font-sm ">{{loadingtext}}</text></view><block wx:for="{{list}}" wx:for-item="item" wx:for-index="index" wx:key="index"><block><free-chat-item class="vue-ref-in-for" vue-id="{{'4ac1f80b-2-'+index}}" isshownickname="{{chat.TO.chat_type=='group'&&chat.TO.shownickname}}" isself="{{item.from_id==user.id}}" item="{{item}}" lasttime="{{index>0?list[index-1].created_time:0}}" Index="{{index}}" data-ref="chatitem" data-event-opts="{{[['^resend',[['resend']]],['^touser',[['touser',['$0'],[[['list','',index]]]]]],['^preview',[['preview',['$event']]]],['^longtouch',[['longtouch']]]]}}" bind:resend="__e" bind:touser="__e" bind:preview="__e" bind:longtouch="__e" bind:__l="__l"></free-chat-item></block></block></scroll-view><block wx:if="{{mode==='action'||mode==='emoticon'}}"><view data-event-opts="{{[['tap',[['hideactiondefault',['$event']]]]]}}" class="position-fixed  top-0 right-0  left-0 _div" style="{{('bottom:'+getcoverbottom+'px')}}" bindtap="__e"></view></block><view class="flex  align-center position-fixed  bg-white left-0 right-0" style="{{'height:105rpx;'+('bottom:'+inputbottom+'px')}}"><block wx:if="{{mode!=='audio'}}"><text data-event-opts="{{[['tap',[['changemode',['$event']]]]]}}" class="iconfont p-1" style="font-size:50rpx;" bindtap="__e"></text><textarea class="bg-white border flex-1 p-1" style="height:70rpx;" placeholder adjust-position="{{false}}" auto-blur="{{true}}" data-event-opts="{{[['focus',[['onfocus',['$event']]]],['tap',[['onfocus',['$event']]]],['input',[['__set_model',['','sendcontent','$event',[]]]]]]}}" value="{{sendcontent}}" bindfocus="__e" bindtap="__e" bindinput="__e"></textarea></block><block wx:else><text data-event-opts="{{[['tap',[['changemode',['$event']]]]]}}" class="iconfont p-1" style="font-size:50rpx;" bindtap="__e"></text><view data-event-opts="{{[['tap',[['recording',['$event']]]],['touchstart',[['audiotouchstart',['$event']]]],['touchmove',[['audiotouchmove',['$event']]]],['touchend',[['audiotouchend',['$event']]]],['touchcancel',[['audiotouchcancel',['$event']]]]]}}" class="{{['rounded flex-1 p-1  flex align-center justify-center ',isrecording?'bg-hover-light':'bg-white']}}" style="height:80rpx;" bindtap="__e" bindtouchstart="__e" bindtouchmove="__e" bindtouchend="__e" bindtouchcancel="__e"><text class="font text-dark">{{isrecording?'松开 发送':'按住 说话'}}</text></view></block><text data-event-opts="{{[['tap',[['openActionOrEmoticon',['emoticon']]]]]}}" class="iconfont  p-1 " style="font-size:50rpx;" bindtap="__e"></text><block wx:if="{{issend}}"><text data-event-opts="{{[['tap',[['openActionOrEmoticon',['action']]]]]}}" class="iconfont py-1 px-2" style="font-size:50rpx;" bindtap="__e"></text></block><block wx:else><free-button vue-id="4ac1f80b-3" content="发送" disabled="{{false}}" data-event-opts="{{[['^click',[['send',['text']]]]]}}" bind:click="__e" bind:__l="__l"></free-button></block></view><free-popup class="vue-ref" vue-id="4ac1f80b-4" bodyH="{{getmenuheight}}" bodyW="{{320}}" transformOrigin="{{transformOrigin}}" data-ref="popup" bind:__l="__l" vue-slots="{{['default']}}"><view class=" bg-white d-flex flex-column" style="{{'width:230rpx;'+(getmenustyle)}}"><block wx:for="{{extendsmenu}}" wx:for-item="item" wx:for-index="index" wx:key="index"><view class="flex-1 flex   align-center" hover-class="bg-hover-light" data-event-opts="{{[['tap',[['clickevent',['$0','$1'],[[['extendsmenu','',index,'event']],[['extendsmenu','',index]]]]]]]}}" bindtap="__e"><text class="ml-2 py-3  borderbot font flex-1 " style="box-sizing:border-box;">{{item.name}}</text></view></block></view></free-popup><free-popup class="vue-ref" vue-id="4ac1f80b-5" bottom="{{true}}" mask="{{false}}" transformOrigin="center bottom" data-ref="action" bind:__l="__l" vue-slots="{{['default']}}"><view class="border-top border-light-secondary bg-light" style="height:580rpx;"><swiper style="height:510rpx;" indicator-dots="{{getActionOrEmoticonList.length>1}}" autoplay="{{false}}"><block wx:for="{{getActionOrEmoticonList}}" wx:for-item="item" wx:for-index="index" wx:key="index"><swiper-item class="row"><block wx:for="{{item}}" wx:for-item="item2" wx:for-index="index2" wx:key="index2"><block><view data-event-opts="{{[['tap',[['actionevent',['$0'],[[['getActionOrEmoticonList','',index],['','',index2]]]]]]]}}" class="col-3 flex flex-column align-center justify-center" style="height:255rpx;" bindtap="__e"><image style="width:100rpx;height:100rpx;" src="{{item2.icon}}" mode="widthFix"></image><text class="font-sm text-light-muted mt-2">{{item2.name}}</text></view></block></block></swiper-item></block></swiper></view></free-popup><block wx:if="{{isrecording}}"><view class="position-fixed top-0 left-0 right-0  flex align-center justify-center" style="bottom:105rpx;"><view class="flex align-center flex-column justify-center" style="height:360rpx;width:360rpx;background-color:rgba(0,0,0,.5);"><image style="width:150rpx;height:150rpx;" src="/static/audio/recording.gif" mode="widthFix"></image><text class="font text-white mt-3">{{unrecord?'松开手指 取消发送':'手指上滑，取消发送'}}</text></view></view></block><free-confirm class="vue-ref" vue-id="4ac1f80b-6" title="发送给:" confirmH="{{550}}" confirmW="{{600}}" data-ref="confirm" bind:__l="__l" vue-slots="{{['content']}}"><view slot="content"><view class="flex align-center mb-2"><view class="flex align-center"><image style="width:80rpx;height:80rpx;" src="{{carddetail.data||'/static/images/demo/demo6.jpg'}}" mode></image><text class="font-sm ml-2">{{chat.TO.username}}</text></view></view><view class="m-3"><text class="font-sm text-light-muted">{{"[个人名片]"+carddetail.options.name}}</text></view><view class="p-1 m-2 border-bottom"><input class="font-sm " style="height:60rpx;" type="text" placeholder="给朋友留言" placeholder-class=" text-light-muted font-sm " data-event-opts="{{[['input',[['__set_model',['','sendcontent','$event',[]]]]]]}}" value="{{sendcontent}}" bindinput="__e"/></view></view></free-confirm></view>