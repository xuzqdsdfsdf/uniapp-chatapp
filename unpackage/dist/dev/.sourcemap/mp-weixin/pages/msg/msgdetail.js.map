{"version":3,"sources":["uni-app:///main.js","webpack:////Users/xuzhiqiang/Desktop/Vue项目汇总/uni-app/仿微信/pages/msg/msgdetail.nvue?1f5b","webpack:////Users/xuzhiqiang/Desktop/Vue项目汇总/uni-app/仿微信/pages/msg/msgdetail.nvue?e956","webpack:////Users/xuzhiqiang/Desktop/Vue项目汇总/uni-app/仿微信/pages/msg/msgdetail.nvue?7d73","webpack:////Users/xuzhiqiang/Desktop/Vue项目汇总/uni-app/仿微信/pages/msg/msgdetail.nvue?ea0a","uni-app:///pages/msg/msgdetail.nvue","webpack:////Users/xuzhiqiang/Desktop/Vue项目汇总/uni-app/仿微信/pages/msg/msgdetail.nvue?158c","webpack:////Users/xuzhiqiang/Desktop/Vue项目汇总/uni-app/仿微信/pages/msg/msgdetail.nvue?e652"],"names":["createPage","Page"],"mappings":"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CA;AACA;AACA,GAxMA;AAyMA,WAzMA,uBAyMA;AACA;AACA;AACA;AACA;AACA,GA9MA;AA+MA;AACA;AACA,wDADA;AAEA,wDAFA;AAGA,gFAHA,GADA;;AAMA,YANA,sBAMA;AACA;AACA;AACA;AACA;AACA;AACA,OAJA;AAKA;;AAEA,KAfA;AAgBA;AACA,2BAjBA,qCAiBA;AACA;AACA,KAnBA;AAoBA;AACA,iBArBA,2BAqBA;AACA;AACA,KAvBA;AAwBA,eAxBA,yBAwBA;AACA;AACA,KA1BA;AA2BA;AACA,UA5BA,oBA4BA;AACA;AACA,KA9BA;AA+BA;;AAEA;AACA,kBAlCA,4BAkCA;AACA;AACA,KApCA;AAqCA;AACA,kBAtCA,4BAsCA;AACA;AACA;AACA;AAzCA,IA/MA;;AA2PA,SA3PA,qBA2PA;AACA;AACA;;;;;AAKA;AACA;AACA;AACA;AACA;AACA,KALA;AAMA;AACA;AACA;AACA;AACA;AACA,OAFA,EAEA,IAFA;AAGA,KALA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,oBAFA;AAGA,WAHA,CAEA,YAFA;AAIA;AACA,oCADA;;AAGA;AACA,OARA,MAQA;AACA;AACA,sBADA;AAEA,2BAFA;;AAIA;AACA;AACA,KAvBA;AAwBA,GAxSA;AAySA,SAzSA,qBAySA;AACA;AACA,GA3SA;AA4SA;AACA;AACA,sBAFA,8BAEA,IAFA,EAEA;AACA;AACA;AACA;AACA,uBADA;AAEA,6BAFA;AAGA,+BAHA;;AAKA;AACA;AACA;AACA,OAHA;AAIA,KAdA;AAeA,gCAfA;AAgBA,WAhBA,mBAgBA,GAhBA,EAgBA;AACA;AACA,oBADA;AAEA,2BAFA;;AAIA,KArBA;AAsBA,gBAtBA,0BAsBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CADA;AAEA,uEAFA;AAGA,iCAHA;;AAKA;AACA;AACA;AACA,KA1CA;AA2CA,qBA3CA,+BA2CA;AACA;AACA;AACA;AACA;AACA,KAhDA;AAiDA,WAjDA,qBAiDA;AACA;AACA;AACA,KApDA;;AAsDA;AACA,SAvDA,mBAuDA;AACA;AACA,uBADA;;AAGA;AACA;AACA,6BADA,EACA;AACA,2CAFA,IADA;;;AAMA,KAjEA;AAkEA;AACA,wBAnEA,kCAmEA;AACA;AACA;AACA;AACA;AACA;AACA,KAzEA;AA0EA;AACA,eA3EA,uBA2EA,IA3EA,EA2EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBADA;AAEA;AACA;AACA;AACA;AACA,eAFA;AAGA,aAPA;;AASA;AACA;AACA;AACA,2BADA;AAEA,oBAFA;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA,aAVA;;AAYA;AACA;AACA;AACA,gBA/BA;;;AAkCA,KA9GA;AA+GA,cA/GA,wBA+GA;AACA;AACA;AACA,KAlHA;AAmHA;AACA,aApHA;;;;AAwHA,SAHA,IAGA,SAHA,IAGA,CAFA,GAEA,SAFA,GAEA,CADA,KACA,SADA,KACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OALA;AAMA;AACA;AACA,KAtIA;AAuIA,cAvIA,sBAuIA,CAvIA,EAuIA,IAvIA,EAuIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yDAXA;;AAaA;AACA,KAtJA;AAuJA;AACA,iBAxJA,yBAwJA,IAxJA,EAwJA;AACA;AACA;AACA;AACA,YADA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,6BADA;AAEA,2CAFA;AAGA;AACA;AACA;AACA,SANA;AAOA;AACA;AACA;AACA,KA5KA;AA6KA;AACA,gBA9KA,wBA8KA,IA9KA,EA8KA;AACA;AACA;AACA,yBADA;AAEA,yBAFA;AAGA,+BAHA,IADA;;;AAOA,KAtLA;AAuLA;AACA,UAxLA,oBAwLA;AACA;AACA,4DADA;;AAGA,KA5LA;AA6LA;AACA,UA9LA,oBA8LA;AACA;AACA;AACA;AACA,2BADA;AAEA,2BAFA;AAGA,iCAHA;AAIA,UAJA,CAIA;AACA;AACA;AACA;AACA,SAFA;AAGA;AACA;AACA;AACA,OAZA;AAaA,KA9MA;AA+MA,cA/MA,wBA+MA;AACA;AACA;AACA;AACA;AACA;AACA,SAFA;AAGA;AACA,KAvNA;AAwNA,YAxNA,sBAwNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAjOA;AAkOA,QAlOA,gBAkOA,IAlOA,EAkOA;AACA,qBADA,GACA,kBADA;AAEA,oBAFA;AAGA,sBAHA;AAIA,0CAJA;;;AAOA,2BAPA,GAOA;AACA,4BADA;AAEA,4BAFA;AAGA,kCAHA,GAPA;;AAYA;AACA;AACA;AACA;AACA;;AAEA,iBALA,EAKA,KALA,CAKA;AACA;AACA;AACA,iBARA;AASA;AACA;AACA;AACA,iBAFA,EAEA,GAFA,EAvBA;AA0BA,KA5PA;AA6PA;AACA,UA9PA,kBA8PA,IA9PA,EA8PA;AACA;AACA;AACA,OAFA;AAGA;AACA;AACA,uBADA;AAEA,uBAFA;AAGA,6BAHA;;AAKA;AACA;AACA,iBADA;AAEA,iBAFA;AAGA,UAHA,EAGA,MAHA,EAGA,IAHA,CAGA;AACA;AACA;AACA;;AAEA,OARA,EAQA,KARA,CAQA;AACA;AACA;AACA,OAXA;AAYA,KArRA;AAsRA;AACA,mBAvRA,2BAuRA,CAvRA,EAuRA;AACA;AACA;AACA,qBADA;;AAGA;AACA,KA7RA;AA8RA,iBA9RA,yBA8RA,CA9RA,EA8RA;AACA;AACA;AACA,KAjSA;AAkSA,kBAlSA,0BAkSA,CAlSA,EAkSA;;AAEA;AACA;AACA,KAtSA;AAuSA,oBAvSA,8BAuSA;AACA;AACA;AACA,KA1SA;AA2SA,UA3SA,kBA2SA,IA3SA,EA2SA;AACA;AACA,0EADA;;AAGA,KA/SA,GA5SA,E;;;;;;;;;;;;;ACvJA;AAAA;AAAA;AAAA;AAA0sC,CAAgB,qmCAAG,EAAC,C;;;;;;;;;;;ACA9tC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/msg/msgdetail.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/msg/msgdetail.nvue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./msgdetail.nvue?vue&type=template&id=4abdda23&\"\nvar renderjs\nimport script from \"./msgdetail.nvue?vue&type=script&lang=js&\"\nexport * from \"./msgdetail.nvue?vue&type=script&lang=js&\"\nimport style0 from \"./msgdetail.nvue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/msg/msgdetail.nvue\"\nexport default component.exports","export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./msgdetail.nvue?vue&type=template&id=4abdda23&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./msgdetail.nvue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./msgdetail.nvue?vue&type=script&lang=js&\"","<style>\n  view,\n  label,\n  swiper-item,\n  scroll-view {\n    display:flex;\n    flex-direction:column;\n    flex-shrink: 0;\n    flex-grow: 0;\n    flex-basis: auto;\n    align-items: stretch;\n    align-content: flex-start;\n  }\n  view,\n  image,\n  input,\n  scroll-view,\n  swiper,\n  swiper-item,\n  text,\n  textarea,\n  video {\n    position: relative;\n    border: 0px solid #000000;\n    box-sizing: border-box;\n  }\n  swiper-item {\n    position: absolute;\n  }\n  button {\n    margin: 0;\n  }\n</style>\n<template>\r\n\t<view class=\"page\">\r\n\t\t<!-- 头部 -->\r\n\t\t<free-navbar isshowback isshowdefaultcolor :title=\"chat.TO.username||chat.TO.name\"\r\n\t\t\t:noreadnum=\"allnoreadnum>0?allnoreadnum:''\" :showsearch=\"false\">\r\n\t\t\t<view slot=\"options\">\r\n\t\t\t\t<text class=\"iconfont mr-2\" @click=\"toset\">&#xe65d;</text>\r\n\t\t\t</view>\r\n\t\t</free-navbar>\r\n\t\t<!-- 聊天窗体 -->\r\n\t\t<scroll-view class=\"position-fixed page left-0 right-0  px-3 \" ref=\"chatbody\" :show-scrollbar=\"false\" scroll-y\r\n\t\t\t:style=\"'top:'+navheight+'px;'+'bottom:'+chatbodybottom+'px'\" :scroll-top=\"9999\">\r\n\t\t\t<view class=\"flex align-center justify-center mb-2\">\r\n\t\t\t\t<text class=\"text-light-muted font-sm \">{{loadingtext}}</text>\r\n\t\t\t</view>\r\n\t\t\t<block v-for=\"(item,index) in list\" :key=\"index\">\r\n\t\t\t\t<free-chat-item :isshownickname=\"chat.TO.chat_type=='group' && chat.TO.shownickname \" @resend=\"resend\"\r\n\t\t\t\t\t:isself=\"item.from_id == user.id\" @touser='touser(item)' @preview=\"preview($event)\"\r\n\t\t\t\t\t@longtouch=\"longtouch\" :item=\"item\" ref=\"chatitem\"\r\n\t\t\t\t\t:lasttime=\"index>0 ? list[index-1].created_time : 0\" :Index=\"index\"></free-chat-item>\r\n\t\t\t</block>\r\n\t\t</scroll-view>\r\n\t\t<!-- 点击聊天窗体关闭action -->\r\n\t\t<div v-if=\"mode==='action'|| mode==='emoticon'\" class=\"position-fixed  top-0 right-0  left-0\"\r\n\t\t\t:style=\"'bottom:'+getcoverbottom+'px'\" @click=\"hideactiondefault\"></div>\r\n\t\t<!-- 底部输入框 -->\r\n\t\t<view class=\"flex  align-center position-fixed  bg-white left-0 right-0\" :style=\"'bottom:'+inputbottom+'px'\"\r\n\t\t\tstyle=\"height: 105upx\">\r\n\t\t\t<template v-if=\"mode!=='audio'\">\r\n\t\t\t\t<text class=\"iconfont p-1\" style=\"font-size: 50upx;\" @click=\"changemode\">&#xe7d4;</text>\r\n\t\t\t\t<textarea v-model=\"sendcontent\" placeholder=\"\" @focus=\"onfocus\" :adjust-position=\"false\"\r\n\t\t\t\t\tstyle=\"height: 70upx\" @click=\"onfocus\" :auto-blur=\"true\" class=\"bg-white border flex-1 p-1\" />\r\n\t\t\t</template>\r\n\t\t\t<template v-else>\r\n\t\t\t\t<text class=\"iconfont p-1\" style=\"font-size: 50upx;\" @click=\"changemode\">&#xe608;</text>\r\n\t\t\t\t<view @click=\"recording\" @touchstart=\"audiotouchstart\" @touchmove=\"audiotouchmove\"\r\n\t\t\t\t\t@touchend=\"audiotouchend\" @touchcancel=\"audiotouchcancel\"\r\n\t\t\t\t\tclass=\"rounded flex-1 p-1  flex align-center justify-center \"\r\n\t\t\t\t\t:class=\"isrecording?'bg-hover-light':'bg-white'\" style=\"height: 80rpx;\">\r\n\t\t\t\t\t<text class=\"font text-dark\">{{isrecording?'松开 发送':'按住 说话'}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t</template>\r\n\t\t\t<text class=\"iconfont  p-1 \" @click=\"openActionOrEmoticon('emoticon')\"\r\n\t\t\t\tstyle=\"font-size: 50upx;\">&#xe613;</text>\r\n\t\t\t<text v-if=\"issend\" @click=\"openActionOrEmoticon('action')\" class=\"iconfont py-1 px-2\"\r\n\t\t\t\tstyle=\"font-size: 50upx;\">&#xe61c;</text>\r\n\t\t\t<free-button v-else content=\"发送\" :disabled=\"false\" @click=\"send('text')\"></free-button>\r\n\t\t</view>\r\n\t\t<!-- 弹出层 -->\r\n\t\t<free-popup ref=\"popup\" :bodyH=\"getmenuheight\" :bodyW=\"320\" :transformOrigin=\"transformOrigin\">\r\n\t\t\t<view style=\"width:230upx\" :style=\"getmenustyle\" class=\" bg-white d-flex flex-column\">\r\n\t\t\t\t<view class=\"flex-1 flex   align-center\" @click=\"clickevent(item.event,item)\"\r\n\t\t\t\t\thover-class=\"bg-hover-light\" v-for=\"(item,index) in extendsmenu\" :key=\"index\">\r\n\t\t\t\t\t<text class=\"ml-2 py-3  borderbot font flex-1 \" style=\"box-sizing: border-box;\">{{item.name}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</free-popup>\r\n\t\t<!-- 拓展菜单 -->\r\n\t\t<free-popup ref=\"action\" bottom :mask=\"false\" transformOrigin=\"center bottom\">\r\n\t\t\t<view class=\"border-top border-light-secondary bg-light\" style=\"height: 580upx\">\r\n\t\t\t\t<swiper :indicator-dots=\"getActionOrEmoticonList.length>1\" :autoplay=\"false\" style=\"height: 510upx;\">\r\n\t\t\t\t\t<swiper-item class=\"row\" v-for=\"(item,index) in getActionOrEmoticonList\" :key=\"index\">\r\n\t\t\t\t\t\t<block v-for=\"(item2,index2) in item\" :key=\"index2\">\r\n\t\t\t\t\t\t\t<view class=\"col-3 flex flex-column align-center justify-center\" style=\"height: 255upx;\"\r\n\t\t\t\t\t\t\t\t@click=\"actionevent(item2)\">\r\n\t\t\t\t\t\t\t\t<image :src=\"item2.icon\" mode=\"widthFix\" style=\"width: 100upx;height: 100upx;\"></image>\r\n\t\t\t\t\t\t\t\t<text class=\"font-sm text-light-muted mt-2\">{{item2.name}}</text>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</block>\r\n\t\t\t\t\t</swiper-item>\r\n\t\t\t\t</swiper>\r\n\t\t\t</view>\r\n\t\t</free-popup>\r\n\t\t<!-- 录音模块 -->\r\n\t\t<view v-if=\"isrecording\" class=\"position-fixed top-0 left-0 right-0  flex align-center justify-center\"\r\n\t\t\tstyle=\"bottom: 105rpx;\">\r\n\t\t\t<view class=\"flex align-center flex-column justify-center\"\r\n\t\t\t\tstyle=\"height: 360rpx;width: 360rpx;background-color: rgba(0,0,0,.5);\">\r\n\t\t\t\t<image src=\"/static/audio/recording.gif\" mode=\"widthFix\" style=\"width: 150rpx;height: 150rpx;\" />\r\n\t\t\t\t<text class=\"font text-white mt-3\">{{unrecord ? '松开手指 取消发送':'手指上滑，取消发送'}}</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<free-confirm ref=\"confirm\" title=\"发送给:\" :confirmH=\"550\" :confirmW=\"600\">\r\n\t\t\t<view slot=\"content\" class=\"\">\r\n\t\t\t\t<view class=\"flex align-center mb-2\">\r\n\t\t\t\t\t<view class=\"flex align-center\">\r\n\t\t\t\t\t\t<image :src=\"carddetail.data||'/static/images/demo/demo6.jpg'\"\r\n\t\t\t\t\t\t\tstyle=\"width: 80rpx;height: 80rpx;\" mode=\"\"></image>\r\n\t\t\t\t\t\t<text class=\"font-sm ml-2\">{{chat.TO.username}}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"m-3\">\r\n\t\t\t\t\t<text class=\"font-sm text-light-muted\">[个人名片]{{carddetail.options.name}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"p-1 m-2 border-bottom\">\r\n\t\t\t\t\t<input type=\"text\" v-model=\"sendcontent\" placeholder=\"给朋友留言\" style=\"height: 60rpx;\" class=\"font-sm \"\r\n\t\t\t\t\t\tplaceholder-class=\" text-light-muted font-sm \" />\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</free-confirm>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport $H from '@/common/free-lib/request.js'\r\n\tconst dom = weex.requireModule('dom')\r\n\tconst RECORD = uni.getRecorderManager();\r\n\timport freeButton from '@/components/free-ui/free-button.vue'\r\n\timport freePopup from '@/components/free-ui/free-popup.vue'\r\n\timport freeChatItem from '@/components/free-ui/free-chat-item.vue'\r\n\timport freeNavbar from '@/components/free-ui/free-navbar.vue'\r\n\timport mixins from '@/common/mixins/mixins.js'\r\n\timport freeConfirm from '@/components/free-ui/free-confirm.vue'\r\n\timport {\r\n\t\tmapActions,\r\n\t\tmapState\r\n\t} from 'vuex'\r\n\timport auth from '@/common/mixins/auth.js'\r\n\texport default {\r\n\t\tcomponents: {\r\n\t\t\tfreeNavbar,\r\n\t\t\tfreeChatItem,\r\n\t\t\tfreePopup,\r\n\t\t\tfreeButton,\r\n\t\t\tfreeConfirm\r\n\t\t},\r\n\t\tmixins: [auth, mixins],\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tloadingtext: '上拉加载更多记录',\r\n\t\t\t\tpage: 1,\r\n\t\t\t\tsendcontent: '',\r\n\t\t\t\tstatusbarheight: 0,\r\n\t\t\t\t// 键盘高度\r\n\t\t\t\t// 模式\r\n\t\t\t\tmode: 'text',\r\n\t\t\t\tsendcontent: '',\r\n\t\t\t\tinputbottom: 0,\r\n\t\t\t\ttransformOrigin: \"left top\",\r\n\t\t\t\tnavheight: 0,\r\n\t\t\t\tpopupindex: -1,\r\n\t\t\t\textendsmenu: [{\r\n\t\t\t\t\t\tname: '复制',\r\n\t\t\t\t\t\tevent: '',\r\n\t\t\t\t\t\ticon: '\\ue63f'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: '发送给朋友',\r\n\t\t\t\t\t\tevent: 'sendtofriend',\r\n\t\t\t\t\t\ticon: '\\ue61f'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: '收藏',\r\n\t\t\t\t\t\tevent: '',\r\n\t\t\t\t\t\ticon: '\\ue62d'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: '删除',\r\n\t\t\t\t\t\tevent: 'delChatDetail',\r\n\t\t\t\t\t\ticon: '\\ue60c',\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: '多选',\r\n\t\t\t\t\t\tevent: '',\r\n\t\t\t\t\t\ticon: '\\ue678'\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: '撤回',\r\n\t\t\t\t\t\tevent: 'recall',\r\n\t\t\t\t\t\ticon: '\\ue678'\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t\tlist: [],\r\n\t\t\t\tactionList: [\r\n\t\t\t\t\t[{\r\n\t\t\t\t\t\t\tname: '相册',\r\n\t\t\t\t\t\t\ticon: '/static/images/extends/pic.png',\r\n\t\t\t\t\t\t\tevent: 'uploadimage'\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tname: '拍摄',\r\n\t\t\t\t\t\t\ticon: '/static/images/extends/video.png',\r\n\t\t\t\t\t\t\tevent: 'camera'\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tname: '视频通话',\r\n\t\t\t\t\t\t\ticon: '/static/images/extends/phone.png',\r\n\t\t\t\t\t\t\tevent: 'phone'\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tname: '位置',\r\n\t\t\t\t\t\t\ticon: '/static/images/extends/path.png',\r\n\t\t\t\t\t\t\tevent: 'location'\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tname: '红包',\r\n\t\t\t\t\t\t\ticon: '/static/images/extends/hongbao.png',\r\n\t\t\t\t\t\t\tevent: 'hongbao'\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tname: '名片',\r\n\t\t\t\t\t\t\ticon: '/static/images/extends/man.png',\r\n\t\t\t\t\t\t\tevent: 'card'\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tname: '语音输入',\r\n\t\t\t\t\t\t\ticon: '/static/images/extends/audio.png',\r\n\t\t\t\t\t\t\tevent: 'audio'\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tname: '收藏',\r\n\t\t\t\t\t\t\ticon: '/static/images/extends/shoucan.png',\r\n\t\t\t\t\t\t\tevent: 'collection'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t],\r\n\t\t\t\temoticonList: [\r\n\t\t\t\t\t[]\r\n\t\t\t\t],\r\n\t\t\t\t// 录音部分参数\r\n\t\t\t\tisrecording: false,\r\n\t\t\t\t// 是否取消录音\r\n\t\t\t\tunrecord: false,\r\n\t\t\t\tRECORDINGTIMER: null,\r\n\t\t\t\tRECORDINGTIME: 0,\r\n\t\t\t\tdetail: {\r\n\t\t\t\t\tavatar: '',\n\t\t\t\t\tchat_type: '',\n\t\t\t\t\tdata: '',\n\t\t\t\t\tid: 0,\n\t\t\t\t\tistop: 0,\n\t\t\t\t\tnoreadnum: 0,\n\t\t\t\t\tnowarn: 0,\n\t\t\t\t\tshownickname: 0,\n\t\t\t\t\tstrongwarn: 0,\n\t\t\t\t\ttype: '',\n\t\t\t\t\tupdate_time: '',\n\t\t\t\t\tusername: '',\r\n\t\t\t\t},\r\n\t\t\t\tcarddetail: {\r\n\t\t\t\t\tdata: '', //图片\r\n\t\t\t\t\toptions: {\r\n\t\t\t\t\t\tusername: '',\r\n\t\t\t\t\t\tuser_id: '',\r\n\t\t\t\t\t\tname: ''\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\t// 如果拓展菜单的模式为action或者emoticon时就不关闭\r\n\t\t\tmode(newValue, oldValue) {\r\n\t\t\t\tif (newValue !== 'action' && newValue !== 'emoticon') {\r\n\t\t\t\t\tthis.$refs.action.hide();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\n\t\tonShow() {\n\t\t\tif(this.chat.TO)return;\n\t\t\tthis.chat.createObject(this.detail)\n\t\t},\r\n\t\tonLoad(e) {\r\n\t\t\tif (!e.params) {\r\n\t\t\t\treturn this.backToast()\r\n\t\t\t}\r\n\t\t\tlet detail = e.params\n\t\t\tdetail = JSON.parse(decodeURIComponent(detail))\n\t\t\tthis.detail=detail;\n\t\t\t// 创建聊天对象\r\n\t\t\tlet obj = this.chat.createObject(detail)\r\n\t\t\tlet list = this.chat.loadMoreChat();\r\n\t\t\tif (list.length < 10) this.loadingtext = '已全部加载'\r\n\t\t\tthis.list = list\r\n\t\t\tuni.$on('handlemessage', (message) => {\r\n\t\t\t\tif ((message.to_id == this.user.id && message.from_id == this.chat.TO.id && message.chat_type ==\r\n\t\t\t\t\t\t'user') || (message.from_id == this.user.id && message.to_id == this.chat.TO.id) || (\r\n\t\t\t\t\t\tmessage.to_id == this.chat.TO.id && message.chat_type == 'group')) {\r\n\t\t\t\t\tthis.list.push(message)\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tthis.tobottom()\r\n\t\t\t\t\t}, 200)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tuni.$on('onhandlerecall', message => {\r\n\t\t\t\tif ((message.id == this.user.id && message.from_id == this.chat.TO.id && message.chat_type ==\r\n\t\t\t\t\t\t'user') || (message.id == this.chat.TO.id && message.chat_type == 'group')) {\r\n\t\t\t\t\tlet index = this.list.findIndex(v => {\r\n\t\t\t\t\t\treturn v.id == message.message_id && v.chat_type == message.chat_type\r\n\t\t\t\t\t})\r\n\t\t\t\t\tconsole.log(index);\r\n\t\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\t\tthis.list[index].isremove = 1\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tthis.tobottom()\r\n\t\t\t\t\t}, 200)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t// 消息撤回渲染处理\r\n\t\t\tuni.$on('clearhistory', () => {\r\n\t\t\t\tthis.list = []\r\n\t\t\t})\r\n\t\t\tuni.$on('handlecardmessage', this.handlescardmessage)\r\n\t\t\t// 查找历史记录\r\n\t\t\t// 销毁聊天对象\r\n\r\n\t\t},\r\n\t\tonPullDownRefresh() {\r\n\t\t\tif (this.loadingtext !== '上拉加载更多记录') return uni.stopPullDownRefresh();\r\n\t\t\tthis.page++;\r\n\t\t\tlet list = this.chat.loadMoreChat(this.page);\r\n\t\t\tuni.stopPullDownRefresh();\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis.list.unshift(...list)\r\n\t\t\t}, 100)\r\n\t\t\tif (list.length < 10) {\r\n\t\t\t\treturn this.loadingtext = '已全部加载'\r\n\t\t\t}\r\n\t\t},\r\n\t\tdestroyed() {\r\n\t\t\t// uni.$off('handlemessage')\r\n\t\t\tthis.chat.destroyObject();\r\n\t\t\tuni.$off('clearhistory')\r\n\t\t\tuni.$off('handlecardmessage', this.handlescardmessage)\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\t...mapState({\r\n\t\t\t\tchat: state => state.user.chat,\r\n\t\t\t\tuser: state => state.user.user,\r\n\t\t\t\tallnoreadnum: state => state.user.allnoreadnum\r\n\t\t\t}),\r\n\t\t\tchaturls() {\r\n\t\t\t\tlet urls = [];\r\n\t\t\t\tthis.list.forEach(v => {\r\n\t\t\t\t\tif (v.type == 'emoticon' || v.type == \"image\") {\r\n\t\t\t\t\t\turls.push(v.data)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\treturn urls\r\n\r\n\t\t\t},\r\n\t\t\t// 获取弹出框内容列表\r\n\t\t\tgetActionOrEmoticonList() {\r\n\t\t\t\treturn this.mode === 'emoticon' || this.mode === 'action' ? this[`${this.mode}List`] : []\r\n\t\t\t},\r\n\t\t\t// 获取选项高度\r\n\t\t\tgetmenuheight() {\r\n\t\t\t\treturn this.extendsmenu.length > 0 ? 105 * this.extendsmenu.length : 0\r\n\t\t\t},\r\n\t\t\tgetnavstyle() {\r\n\t\t\t\treturn `height:${this.navheight}px`\r\n\t\t\t},\r\n\t\t\t// 计算输入框长度是否显示发送按钮\r\n\t\t\tissend() {\r\n\t\t\t\treturn this.sendcontent.length === 0\r\n\t\t\t},\r\n\t\t\t// 计算是否是本人\r\n\r\n\t\t\t// 聊天内容的高度\r\n\t\t\tchatbodybottom() {\r\n\t\t\t\treturn this.inputbottom + uni.upx2px(105);\r\n\t\t\t},\r\n\t\t\t// 遮盖层的底部高度\r\n\t\t\tgetcoverbottom() {\r\n\t\t\t\treturn this.inputbottom + uni.upx2px(105)\r\n\t\t\t},\r\n\t\t\t// 获取菜单\r\n\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\tthis.mode = 'text'\r\n\t\t\t// 获取状态栏高度\r\n\t\t\t// #ifdef APP-NVUE\r\n\t\t\tthis.statusbarheight = plus.navigator.getStatusbarHeight()\r\n\t\t\tthis.navheight = this.statusbarheight + uni.upx2px(90)\r\n\t\t\t// #endif\r\n\t\t\tuni.onKeyboardHeightChange(res => {\r\n\t\t\t\tif (this.mode === 'text') {\r\n\t\t\t\t\tthis.inputbottom = res.height\r\n\t\t\t\t}\r\n\t\t\t\tthis.tobottom()\r\n\t\t\t})\r\n\t\t\t// 监听录音开始\r\n\t\t\tRECORD.onStart(() => {\r\n\t\t\t\tthis.RECORDINGTIME = 0;\r\n\t\t\t\tthis.RECORDINGTIMER = setInterval(() => {\r\n\t\t\t\t\tthis.RECORDINGTIME++\r\n\t\t\t\t}, 1000)\r\n\t\t\t})\r\n\t\t\t// 监听录音结束\r\n\t\t\tRECORD.onStop((url) => {\r\n\t\t\t\tif (this.RECORDINGTIME <= 1) {\r\n\t\t\t\t\tthis.unrecord = true;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.RECORDINGTIMER) {\r\n\t\t\t\t\tclearInterval(this.RECORDINGTIMER)\r\n\t\t\t\t\tthis.RECORDINGTIMER = null;\r\n\t\t\t\t}\r\n\t\t\t\tif (!this.unrecord) {\r\n\t\t\t\t\tlet {\r\n\t\t\t\t\t\ttempFilePath\r\n\t\t\t\t\t} = url;\r\n\t\t\t\t\tthis.send('audio', tempFilePath, {\r\n\t\t\t\t\t\ttime: this.RECORDINGTIME\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.RECORDINGTIME = 0;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\ttitle: '录音过短或被打断',\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.RECORDINGTIME = 0;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tcreated() {\r\n\t\t\tthis.initemoticon()\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// 卡片处理\r\n\t\t\thandlescardmessage(card) {\r\n\t\t\t\tlet item = card[0]\r\n\t\t\t\tthis.carddetail.data = item.avatar || '/static/images/demo/demo5.jpg';\r\n\t\t\t\tthis.carddetail.options = {\r\n\t\t\t\t\tname: item.name,\r\n\t\t\t\t\tuser_id: item.user_id,\r\n\t\t\t\t\tusername: item.username\r\n\t\t\t\t}\r\n\t\t\t\tthis.$refs['confirm'].open((close) => {\r\n\t\t\t\t\tthis.send('card', this.carddetail.data, this.carddetail.options)\r\n\t\t\t\t\tclose()\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t...mapActions(['$on']),\r\n\t\t\tpreview(url) {\r\n\t\t\t\tuni.previewImage({\r\n\t\t\t\t\tcurrent: url,\r\n\t\t\t\t\turls: this.chaturls\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tinitemoticon() {\r\n\t\t\t\tvar total = 20;\r\n\t\t\t\tvar page = Math.ceil(total / 8)\r\n\t\t\t\tlet arr = []\r\n\t\t\t\tfor (let i = 0; i < page; i++) {\r\n\t\t\t\t\tarr[i] = []\r\n\t\t\t\t\tvar startindex = i * 8\r\n\t\t\t\t\tfor (let j = 0; j < 8; j++) {\r\n\t\t\t\t\t\tvar index = startindex + j\r\n\t\t\t\t\t\tif (index > 19) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tarr[i].push({\r\n\t\t\t\t\t\t\tname: `表情${index}`,\r\n\t\t\t\t\t\t\ticon: `/static/images/emoticon/5497/${index}.gif`,\r\n\t\t\t\t\t\t\tevent: 'sendemoticon'\r\n\t\t\t\t\t\t}, )\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.emoticonList = arr;\r\n\t\t\t},\r\n\t\t\thideactiondefault() {\r\n\t\t\t\tuni.hideKeyboard()\r\n\t\t\t\tthis.hideaction()\r\n\t\t\t\tthis.$refs.action.hide();\r\n\t\t\t\tthis.mode = ''\r\n\t\t\t},\r\n\t\t\tonfocus() {\r\n\t\t\t\tthis.mode = 'text'\r\n\t\t\t\t// this.$refs.action.hide();\r\n\t\t\t},\r\n\r\n\t\t\t// 跳转到聊天设置页面\r\n\t\t\ttoset() {\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: \"chat_set\"\r\n\t\t\t\t})\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: \"chat/chat_set?params=\" + encodeURIComponent(JSON.stringify({\r\n\t\t\t\t\t\tid: this.chat.TO.id, //好友id\r\n\t\t\t\t\t\tchat_type: this.chat.TO.chat_type\r\n\t\t\t\t\t}))\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 打开拓展菜单\r\n\t\t\topenActionOrEmoticon(mode = 'action') {\r\n\t\t\t\tthis.tobottom()\r\n\t\t\t\tthis.mode = mode;\r\n\t\t\t\tuni.hideKeyboard()\r\n\t\t\t\tthis.$refs.action.show();\r\n\t\t\t\tthis.inputbottom = uni.upx2px(580);\r\n\t\t\t},\r\n\t\t\t// 点击拓展菜单选项\r\n\t\t\tactionevent(item) {\r\n\t\t\t\tswitch (item.event) {\r\n\t\t\t\t\tcase 'sendemoticon':\r\n\t\t\t\t\t\tthis.send('emoticon', item.icon)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'uploadimage':\r\n\t\t\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\t\t\tcount: 5,\r\n\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\tlet tempFilePaths = res.tempFilePaths;\r\n\t\t\t\t\t\t\t\ttempFilePaths.forEach(v => {\r\n\t\t\t\t\t\t\t\t\tthis.send('image', v)\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'camera':\r\n\t\t\t\t\t\tuni.chooseVideo({\r\n\t\t\t\t\t\t\tmaxDuration: 10,\r\n\t\t\t\t\t\t\tcount: 1,\r\n\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\tlet url = res.tempFilePath;\r\n\t\t\t\t\t\t\t\t// 渲染页面\r\n\t\t\t\t\t\t\t\tthis.send('video', url)\r\n\t\t\t\t\t\t\t\t// 发送到服务端\r\n\t\t\t\t\t\t\t\t// 修改发送状态\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'card':\r\n\t\t\t\t\t\tthis.tocard()\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\thideaction() {\r\n\t\t\t\t// console.log(123);\r\n\t\t\t\tthis.inputbottom = 0\r\n\t\t\t},\r\n\t\t\t// 长按消息气泡\r\n\t\t\tlongtouch({\r\n\t\t\t\tleft,\r\n\t\t\t\ttop,\r\n\t\t\t\tindex\r\n\t\t\t}) {\r\n\t\t\t\tif (this.list[index].isremove) return;\r\n\t\t\t\tthis.popupindex = index;\r\n\t\t\t\tlet item = this.list[this.popupindex]\r\n\t\t\t\tconsole.log(item);\r\n\t\t\t\tlet isself = item.from_id == this.user.id;\r\n\t\t\t\tthis.extendsmenu.filter(v => {\r\n\t\t\t\t\tif (v.name == '撤回' && !isself) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t})\r\n\t\t\t\tthis.transformOrigin = left < uni.upx2px(375) ? \"left top\" : 'right top'\r\n\t\t\t\tthis.$refs.popup.show(left, top)\r\n\t\t\t},\r\n\t\t\tclickevent(e, item) {\r\n\t\t\t\tswitch (e) {\r\n\t\t\t\t\t// 撤回\r\n\t\t\t\t\tcase 'recall':\r\n\t\t\t\t\t\tthis.recall(this.list[this.popupindex]);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'uploadimage':\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'sendtofriend':\r\n\t\t\t\t\t\tthis.sendtofriend(this.list[this.popupindex]);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'delChatDetail':\r\n\t\t\t\t\t\tthis.delChatDetail(this.list[this.popupindex])\r\n\t\t\t\t}\r\n\t\t\t\tthis.$refs.popup.hide()\r\n\t\t\t},\r\n\t\t\t// 删除指定的聊天记录\r\n\t\t\tdelChatDetail(item) {\r\n\t\t\t\t// 先删除本地存储\r\n\t\t\t\tthis.chat.deleteChatDetailItem(item)\r\n\t\t\t\tlet index = this.list.findIndex(v => v.id == item.id && v.chat_type == item.chat_type && v.type == item\r\n\t\t\t\t\t.type)\r\n\t\t\t\tthis.list.splice(index, 1)\r\n\t\t\t\tif (index == -1) return;\r\n\t\t\t\tlet lastitem = this.list.length > 1 ? this.list[index - 1] : {}\r\n\t\t\t\tconsole.log(index, this.list.length)\r\n\t\t\t\tif (index == this.list.length) {\r\n\t\t\t\t\tthis.chat.updateChatItem({\r\n\t\t\t\t\t\tid: this.chat.TO.id,\r\n\t\t\t\t\t\tchat_type: this.chat.TO.chat_type\r\n\t\t\t\t\t}, (lastdata) => {\r\n\t\t\t\t\t\tlastdata.data = index == 1 ? '' :  this.chat.handlemessagetype(lastitem) \r\n\t\t\t\t\t\treturn lastdata\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\t// 再删除已渲染的list中的记录\r\n\t\t\t\t// 修改index页面的最后一条数据\r\n\t\t\t},\r\n\t\t\t// 跳转到好友列表页面\r\n\t\t\tsendtofriend(item) {\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: \"../mail/user_recommand/user_recommand?params=\" + encodeURIComponent(JSON.stringify({\r\n\t\t\t\t\t\ttype: item.type,\r\n\t\t\t\t\t\tdata: item.data,\r\n\t\t\t\t\t\toptions: item.options\r\n\t\t\t\t\t}))\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 跳转到名片页\r\n\t\t\ttocard() {\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: \"../mail/mail/mail_connector?type=card&limit=1\"\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 撤回消息\r\n\t\t\trecall() {\r\n\t\t\t\tlet item = this.list[this.popupindex];\r\n\t\t\t\tconsole.log(item);\r\n\t\t\t\tthis.chat.recall({\r\n\t\t\t\t\tid: this.chat.TO.id,\r\n\t\t\t\t\tmessage_id: item.id,\r\n\t\t\t\t\tchat_type: item.chat_type\r\n\t\t\t\t}).then(res => {\r\n\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t\tlet index = this.list.findIndex(v => {\r\n\t\t\t\t\t\treturn v.id == res.message_id && v.chat_type == res.chat_type\r\n\t\t\t\t\t})\r\n\t\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\t\tthis.list[index].isremove = 1\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tchangemode() {\r\n\t\t\t\tthis.mode = this.mode !== 'audio' ? 'audio' : 'text';\r\n\t\t\t\tif (this.mode === 'audio') {\r\n\t\t\t\t\tuni.hideKeyboard()\r\n\t\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\t\tthis.inputbottom = 0;\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\ttobottom() {\r\n\t\t\t\tlet chatitems = this.$refs.chatitem;\r\n\t\t\t\tif (chatitems) {\r\n\t\t\t\t\tlet lastindex = chatitems.length > 0 ? chatitems.length - 1 : 0;\r\n\t\t\t\t\tlet lastitem = chatitems[lastindex]\r\n\t\t\t\t\tif (lastitem) {\r\n\t\t\t\t\t\tdom.scrollToElement(lastitem, {})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tasync send(type, data = '', options = {}) {\r\n\t\t\t\tlet index = this.list.length\r\n\t\t\t\tswitch (type) {\r\n\t\t\t\t\tcase 'text':\r\n\t\t\t\t\t\tdata = this.sendcontent\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tlet messagedata = this.chat.formatMessagedata({\r\n\t\t\t\t\ttype,\r\n\t\t\t\t\tdata,\r\n\t\t\t\t\toptions,\r\n\t\t\t\t})\r\n\t\t\t\tthis.list = [...this.list, messagedata]\r\n\t\t\t\tthis.chat.send(messagedata).then((res) => {\r\n\t\t\t\t\t// this.list.push(messagedata)\r\n\t\t\t\t\tthis.list[index].id = res.id\r\n\t\t\t\t\tthis.list[index].sendStatus = 'success'\r\n\r\n\t\t\t\t}).catch(err => {\r\n\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t\tthis.list[index].sendStatus = 'fail'\r\n\t\t\t\t})\r\n\t\t\t\tthis.sendcontent = ''\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthis.tobottom();\r\n\t\t\t\t}, 100)\r\n\t\t\t},\r\n\t\t\t// 重新发送消息\r\n\t\t\tresend(item) {\r\n\t\t\t\tlet index = this.list.findIndex(v => {\r\n\t\t\t\t\treturn v.created_time == item.created_time\r\n\t\t\t\t})\r\n\t\t\t\t// console.log(item);\r\n\t\t\t\tlet messagedata = this.chat.formatMessagedata({\r\n\t\t\t\t\ttype: item.type,\r\n\t\t\t\t\tdata: item.data,\r\n\t\t\t\t\toptions: item.options\r\n\t\t\t\t})\r\n\t\t\t\tconsole.log(item);\r\n\t\t\t\tthis.chat.send({\r\n\t\t\t\t\t...messagedata,\r\n\t\t\t\t\tk: item.k\r\n\t\t\t\t}, true, item.k).then((res) => {\r\n\t\t\t\t\t// this.list.push(messagedata)\r\n\t\t\t\t\tthis.list[index].id = res.id\r\n\t\t\t\t\tthis.list[index].sendStatus = 'success'\r\n\r\n\t\t\t\t}).catch(err => {\r\n\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t\tthis.list[index].sendStatus = 'fail'\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 录音部分\r\n\t\t\taudiotouchstart(e) {\r\n\t\t\t\tthis.isrecording = true;\r\n\t\t\t\tRECORD.start({\r\n\t\t\t\t\tformat: 'mp3'\r\n\t\t\t\t})\r\n\t\t\t\tthis.recordingY = e.changedTouches[0].screenY\r\n\t\t\t},\r\n\t\t\taudiotouchend(e) {\r\n\t\t\t\tRECORD.stop()\r\n\t\t\t\tthis.isrecording = false;\r\n\t\t\t},\r\n\t\t\taudiotouchmove(e) {\r\n\r\n\t\t\t\tlet Y = Math.abs(e.changedTouches[0].screenY - this.recordingY)\r\n\t\t\t\tthis.unrecord = Y > 80\r\n\t\t\t},\r\n\t\t\taudiotouchcancel() {\r\n\t\t\t\tthis.unrecord = true;\r\n\t\t\t\tthis.isrecording = false;\r\n\t\t\t},\r\n\t\t\ttouser(item) {\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: '../mail/user_base/user_base?user_id=' + item.options.user_id,\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\r\n</style>\n","import mod from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./msgdetail.nvue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./msgdetail.nvue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1619531204632\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}